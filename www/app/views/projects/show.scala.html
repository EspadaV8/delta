@(
  data: io.flow.delta.www.lib.UiData,
  project: io.flow.delta.v0.models.Project,
  state: io.flow.delta.v0.models.ProjectState,
  settings: io.flow.delta.v0.models.Settings,
  masterHash: Option[String],
  latestTag: Option[io.flow.delta.v0.models.Tag],
  events: io.flow.play.util.PaginatedCollection[io.flow.delta.v0.models.Event]
)(implicit flash: Flash, messages: Messages)

@main(data.copy(title = Some(project.name))) {

  <div class="pull-right">
    @if(io.flow.delta.www.lib.Permissions.Project.edit(project, data.user)) {
      <a href="@routes.ProjectsController.edit(project.id)">Edit</a>
    }
    @if(io.flow.delta.www.lib.Permissions.Project.delete(project, data.user)) {
      | <a class="delete" data-confirm="Are you sure?" href="@routes.ProjectsController.postDelete(project.id)">Delete</a>
    }

  </div>

  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Current State</th>
          <th>Target State</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>@stateTable(state.actual)</td>
          <td>@stateTable(state.expected)</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <ul>
    <li>Owner: <a href="@routes.OrganizationsController.show(project.organization.id)">@project.organization.id</a></li>
    <li>Visbility: @project.visibility.toString</li>
    <li>SCMS: @project.scms.toString</li>
    <li>Auto tag: @{settings.autoTag match {
      case true => "Enabled"
      case false => "Disabled"
      }} (<a href="@routes.ProjectsController.postSettingsAutoTag(project.id)" class="postForm">toggle</a>)
    </li>
    <li>URI: <a href="@project.uri">@project.uri</a></li>
    <li>Master Sha: @masterHash.getOrElse("-")</li>
    <li>Latest Tag:
      @if(latestTag.isEmpty) {
        -
      } else {
        @latestTag.get.name [@latestTag.get.hash]
      }
    </li>
    <li> <a href="@routes.EventsController.index(project_id = Some(project.id))">View all events for this project</a></li>
  </ul>

  <h3>Changes</h3>
  @if(events.isEmpty) {
    <em>No changes</em>
  } else {
    @views.html.events.eventsTable(events)

    @if(events.hasPrevious || events.hasNext) {
      <ul class="pager">
        @if(events.hasPrevious) {
          <li><a href="@routes.ProjectsController.show(project.id, eventsPage = events.page - 1)">Previous</a></li>
        }
        @if(events.hasNext) {
          <li><a href="@routes.ProjectsController.show(project.id, eventsPage = events.page + 1)">Next</a></li>
        }
      </ul>
    }

  }

  
}
